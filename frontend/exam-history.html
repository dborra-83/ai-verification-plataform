<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><span id="platformTitle">EduTech AI</span> - Historial de Exámenes</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Configuration -->
    <script src="config.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1><i class="bi bi-mortarboard me-2"></i><span id="platformName">EduTech AI</span></h1>
                <p>Plataforma Educativa Docente</p>
            </div>

            <div class="sidebar-nav">
                <!-- Sección Detección de IA -->
                <div class="nav-section-header">
                    <i class="bi bi-shield-check me-2"></i>
                    Detección de IA
                </div>
                <a href="index.html" class="nav-item">
                    <i class="bi bi-speedometer2"></i>
                    Dashboard
                </a>
                <a href="index.html#upload" class="nav-item">
                    <i class="bi bi-cloud-upload"></i>
                    Nuevo Análisis
                </a>
                <a href="index.html#history" class="nav-item">
                    <i class="bi bi-clock-history"></i>
                    Historial
                </a>
                <a href="index.html#analytics" class="nav-item">
                    <i class="bi bi-graph-up"></i>
                    Analytics y Reportes
                </a>
                
                <!-- Sección Generación de Exámenes -->
                <div class="nav-section-header">
                    <i class="bi bi-file-earmark-text me-2"></i>
                    Exámenes con IA
                </div>
                <a href="exam-dashboard.html" class="nav-item">
                    <i class="bi bi-speedometer2"></i>
                    Dashboard
                </a>
                <a href="exam-generator.html" class="nav-item">
                    <i class="bi bi-plus-circle"></i>
                    Generador de Exámenes
                </a>
                <a href="exam-history.html" class="nav-item active">
                    <i class="bi bi-journal-text"></i>
                    Historial de Exámenes
                </a>
                
                <!-- Sección Administración -->
                <div class="nav-section-header">
                    <i class="bi bi-gear-wide-connected me-2"></i>
                    Administración
                </div>
                <a href="admin-dashboard.html" class="nav-item">
                    <i class="bi bi-sliders"></i>
                    Configuración
                </a>
                
                <!-- Otras Demos -->
                <div class="nav-section-header">
                    <i class="bi bi-collection-play me-2"></i>
                    Otras Demos
                </div>
                <a href="https://d2wi2vfruzr64e.cloudfront.net/" class="nav-item" target="_blank">
                    <i class="bi bi-pc-display"></i>
                    Entornos Virtuales
                    <i class="bi bi-box-arrow-up-right ms-auto" style="font-size: 0.8rem; opacity: 0.7;"></i>
                </a>
                <a href="https://d1btovt86fwovd.cloudfront.net/" class="nav-item" target="_blank">
                    <i class="bi bi-exclamation-triangle"></i>
                    Detección Temprana de Riesgo Académico
                    <i class="bi bi-box-arrow-up-right ms-auto" style="font-size: 0.8rem; opacity: 0.7;"></i>
                </a>
                
                <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 1.5rem;">
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i>
                    Cerrar Sesión
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <h2 id="pageTitle">Historial de Exámenes</h2>
                <div class="topbar-actions">
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" placeholder="Buscar exámenes..." id="searchInput">
                    </div>
                    <div class="user-avatar" title="Admin">
                        A
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Breadcrumb -->
                <div class="breadcrumb-container mb-3">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Historial de Exámenes</li>
                        </ol>
                    </nav>
                </div>

                <!-- Summary Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body kpi-card">
                                <h3 class="kpi-value text-primary" id="totalExams">-</h3>
                                <p class="kpi-label">Total Exámenes</p>
                                <small class="kpi-trend text-muted">Generados hasta ahora</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body kpi-card">
                                <h3 class="kpi-value text-success" id="completedExams">-</h3>
                                <p class="kpi-label">Completados</p>
                                <small class="kpi-trend text-muted">Listos para descargar</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body kpi-card">
                                <h3 class="kpi-value text-warning" id="processingExams">-</h3>
                                <p class="kpi-label">En Proceso</p>
                                <small class="kpi-trend text-muted">Generándose actualmente</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body kpi-card">
                                <h3 class="kpi-value text-danger" id="failedExams">-</h3>
                                <p class="kpi-label">Fallidos</p>
                                <small class="kpi-trend text-muted">Con errores</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters and Actions -->
                <div class="card mb-4">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h5 class="mb-0">
                                    <i class="bi bi-funnel me-2"></i>
                                    Filtros y Acciones
                                </h5>
                            </div>
                            <div class="col-auto">
                                <div class="btn-group">
                                    <button class="btn btn-outline-secondary" onclick="window.location.href='exam-dashboard.html'">
                                        <i class="bi bi-speedometer2 me-2"></i>
                                        Dashboard
                                    </button>
                                    <button class="btn btn-primary" onclick="window.location.href='exam-generator.html'">
                                        <i class="bi bi-plus-circle me-2"></i>
                                        Nuevo Examen
                                    </button>
                                    <button class="btn btn-outline-success" onclick="exportHistory()">
                                        <i class="bi bi-download me-2"></i>
                                        Exportar Historial
                                    </button>
                                    <button class="btn btn-outline-info" onclick="window.location.href='admin-dashboard.html'" title="Analytics para Exámenes con IA">
                                        <i class="bi bi-file-earmark-text me-2"></i>
                                        Analytics - Exámenes IA
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="filterTeacher" class="form-label">Profesor</label>
                                <select class="form-select" id="filterTeacher">
                                    <option value="current">Mis exámenes</option>
                                    <option value="all">Todos los profesores</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterStatus" class="form-label">Estado</label>
                                <select class="form-select" id="filterStatus">
                                    <option value="">Todos los estados</option>
                                    <option value="COMPLETED">Completado</option>
                                    <option value="PROCESSING">En Proceso</option>
                                    <option value="FAILED">Fallido</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="filterFrom" class="form-label">Desde</label>
                                <input type="date" class="form-control" id="filterFrom">
                            </div>
                            <div class="col-md-2">
                                <label for="filterTo" class="form-label">Hasta</label>
                                <input type="date" class="form-control" id="filterTo">
                            </div>
                            <div class="col-md-2">
                                <label for="filterTopic" class="form-label">Tema</label>
                                <input type="text" class="form-control" id="filterTopic" placeholder="Buscar tema...">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="applyFilters()">
                                    <i class="bi bi-funnel me-2"></i>
                                    Filtrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exam History Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h5 class="mb-0">
                                    <i class="bi bi-journal-text me-2"></i>
                                    Historial de Exámenes Generados
                                </h5>
                            </div>
                            <div class="col-auto">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="refreshHistory()" title="Actualizar">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                    <button class="btn btn-outline-info" onclick="showColumnSelector()" title="Columnas">
                                        <i class="bi bi-columns"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID Examen</th>
                                        <th>Profesor</th>
                                        <th>Fecha Creación</th>
                                        <th>Estado</th>
                                        <th>Preguntas</th>
                                        <th>Dificultad</th>
                                        <th>Versiones</th>
                                        <th>Temas</th>
                                        <th>Archivos</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="examHistoryTable">
                                    <tr>
                                        <td colspan="10" class="text-center text-muted">
                                            <i class="bi bi-hourglass-split me-2"></i>
                                            Cargando historial de exámenes...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Paginación del historial" class="mt-3">
                            <ul class="pagination justify-content-center" id="examHistoryPagination">
                            </ul>
                        </nav>
                    </div>
                </div>

                <!-- Exam Analytics Section -->
                <div id="examAnalyticsSection" style="display: none;">
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="mb-0">
                                                <i class="bi bi-graph-up me-2"></i>
                                                Analytics y Reportes - Generación de Exámenes
                                            </h5>
                                        </div>
                                        <div class="col-auto">
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary" onclick="exportExamAnalyticsToPDF()"
                                                    title="Exportar Analytics a PDF">
                                                    <i class="bi bi-file-earmark-pdf me-1"></i>PDF
                                                </button>
                                                <button class="btn btn-outline-success"
                                                    onclick="exportExamAnalyticsToExcel()" title="Exportar Datos a Excel">
                                                    <i class="bi bi-file-earmark-excel me-1"></i>Excel
                                                </button>
                                                <button class="btn btn-secondary" onclick="showExamHistory()">
                                                    <i class="bi bi-arrow-left me-2"></i>
                                                    Volver al Historial
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- Time Period Selector -->
                                    <div class="row mb-4">
                                        <div class="col-md-4">
                                            <label for="examAnalyticsPeriod" class="form-label">Período de Análisis</label>
                                            <select class="form-select" id="examAnalyticsPeriod"
                                                onchange="loadExamAnalyticsData()">
                                                <option value="7">Últimos 7 días</option>
                                                <option value="30" selected>Últimos 30 días</option>
                                                <option value="90">Últimos 90 días</option>
                                                <option value="180">Últimos 6 meses</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8 d-flex align-items-end">
                                            <button class="btn btn-primary" onclick="loadExamAnalyticsData()">
                                                <i class="bi bi-arrow-clockwise me-2"></i>
                                                Actualizar Datos
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 1 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-bar-chart me-2"></i>
                                        Tendencia de Generación de Exámenes
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="examGenerationTimeChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-pie-chart me-2"></i>
                                        Distribución por Dificultad
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="examDifficultyChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 2 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-graph-up me-2"></i>
                                        Promedio de Preguntas por Examen
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="examQuestionsChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-speedometer2 me-2"></i>
                                        Tipos de Preguntas Más Usados
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="questionTypesChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Rankings -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-trophy me-2"></i>
                                        Top 10 Temas Más Utilizados
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Tema</th>
                                                    <th>Exámenes</th>
                                                    <th>Frecuencia</th>
                                                </tr>
                                            </thead>
                                            <tbody id="topTopicsTable">
                                                <tr>
                                                    <td colspan="4" class="text-center text-muted">
                                                        <i class="bi bi-hourglass-split me-2"></i>
                                                        Cargando datos...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-person-check me-2"></i>
                                        Top 10 Profesores por Actividad
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Profesor</th>
                                                    <th>Exámenes</th>
                                                    <th>Promedio Preguntas</th>
                                                </tr>
                                            </thead>
                                            <tbody id="topTeachersTable">
                                                <tr>
                                                    <td colspan="4" class="text-center text-muted">
                                                        <i class="bi bi-hourglass-split me-2"></i>
                                                        Cargando datos...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Exam Detail Modal -->
    <div class="modal fade" id="examDetailModal" tabindex="-1" aria-labelledby="examDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="examDetailModalLabel">
                        <i class="bi bi-file-earmark-text me-2"></i>
                        Detalles del Examen
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="examDetailContent">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="downloadExamBtn" onclick="downloadExamFiles()">
                        <i class="bi bi-download me-2"></i>
                        Descargar Archivos
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">
                        <i class="bi bi-download me-2"></i>
                        Exportar Historial
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="exportForm">
                        <div class="mb-3">
                            <label for="exportFormat" class="form-label">Formato de Exportación</label>
                            <select class="form-select" id="exportFormat" required>
                                <option value="csv">CSV (Comma Separated Values)</option>
                                <option value="excel">Excel (XLSX)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="exportTeacher" class="form-label">Filtrar por Profesor</label>
                            <select class="form-select" id="exportTeacher">
                                <option value="all">Todos los profesores</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="exportStartDate" class="form-label">Fecha Inicio</label>
                                    <input type="date" class="form-control" id="exportStartDate">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="exportEndDate" class="form-label">Fecha Fin</label>
                                    <input type="date" class="form-control" id="exportEndDate">
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <small>El archivo exportado incluirá todos los detalles de configuración y metadatos de los exámenes.</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="performExport()">
                        <i class="bi bi-download me-2"></i>
                        Exportar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Cognito SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1472.0.min.js"></script>
    <script src="config.js"></script>
    <script src="js/platform-config.js?v=6"></script>
    <!-- Auth Module -->
    <script src="js/auth.js?v=6"></script>
    <!-- Route Guard -->
    <script src="js/route-guard.js?v=6"></script>
    <!-- Custom JS -->
    <script src="js/app.js?v=6"></script>
    <script src="js/exam-history.js"></script>
</body>

</html>
</content>